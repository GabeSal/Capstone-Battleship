var Battleship=Battleship||{};Battleship.GameState=Battleship.GameState||{},Battleship.GameState.SHOT_DELAY=200,Battleship.GameState.BULLET_SPEED=850,Battleship.GameState.reservedBullets=6,Battleship.GameState.BOARD_COLS,Battleship.GameState.BOARD_ROWS,Battleship.GameState.CELL_SIZE=64,Battleship.GameState.CELL_SPACING=2,Battleship.GameState.CELL_SIZE_SPACED=Battleship.GameState.CELL_SIZE+Battleship.GameState.CELL_SPACING,Battleship.GameState.lastBulletShotAt=void 0,Battleship.GameState.cells,Battleship.GameState.selectedCell=null,Battleship.GameState.selectedCellStartPos={x:0,y:0},Battleship.GameState.levels={},Battleship.GameState.ship2={},Battleship.GameState.ship3={},Battleship.GameState.ship4={},Battleship.GameState.ship5={},Battleship.GameState.ship6={},Battleship.GameState.gameOver=!1,Battleship.HomeState=Battleship.HomeState||{},Battleship.HomeState.intro_text,Battleship.HomeState.init=function(){},Battleship.HomeState.preload=function(){},Battleship.HomeState.create=function(){this.game.stage.backgroundColor="#4488cc";var t=this.game.add.graphics();t.beginFill(0,.2),t.drawRect(0,300,800,100);var e={font:"bold 32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};this.intro_text=this.game.add.text(0,0,"Tap Screen to Start",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100),t.inputEnabled=!0,t.events.onInputDown.add(this.gameStart,this)},Battleship.HomeState.gameStart=function(t){this.game.data.turn="player",this.game.state.start("GameState")},Battleship.HomeState.shutdown=function(){console.log("shutdown homestate")},Battleship.TurnState=Battleship.TurnState||{},Battleship.TurnState.intro_text,Battleship.TurnState.init=function(){},Battleship.TurnState.preload=function(){},Battleship.TurnState.create=function(){this.game.stage.backgroundColor="#3D3D3C";var t=this.game.add.graphics();t.beginFill(383533,.2),t.drawRect(0,300,800,100);var e={font:"bold 32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};"enemy"==this.game.data.turn?(this.intro_text=this.game.add.text(0,0,"Enemy's Turn",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)):(this.intro_text=this.game.add.text(0,0,"Your Turn",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)),t.inputEnabled=!0,t.events.onInputDown.add(this.gameStart,this)},Battleship.TurnState.gameStart=function(t){this.game.state.start("GameState")},Battleship.TurnState.shutdown=function(){console.log("shutdown homestate")},Battleship.GameOverState=Battleship.GameOverState||{},Battleship.GameOverState.intro_text,Battleship.GameOverState.init=function(){},Battleship.GameOverState.preload=function(){},Battleship.GameOverState.create=function(){this.game.stage.backgroundColor="#222";var t=this.game.add.graphics();t.beginFill(0,.2),t.drawRect(0,300,800,100);var e={font:"bold 32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};"player"==this.game.data.loser?(this.intro_text=this.game.add.text(0,0,"You Lost! Tap to Restart",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)):"enemy"==this.game.data.loser&&(this.intro_text=this.game.add.text(0,0,"You Win! Tap to Restart",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)),t.inputEnabled=!0,t.events.onInputDown.add(this.gameStart,this)},Battleship.GameOverState.gameStart=function(){this.game.state.start("GameState")},Battleship.GameOverState.shutdown=function(){console.log("shutdown game over")},Battleship.GameState.init=function(){this.game.physics.startSystem(Phaser.Physics.ARCADE),this.reservedBullets=6,this.matrix=[[[0,0,0,0,0,0,0,0,2,2],[0,5,5,5,5,5,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,4,0,0,0]],[[0,0,0,0,0,5,0,0,2,0],[0,0,0,0,0,5,0,0,2,0],[0,0,0,6,0,5,0,0,0,0],[0,0,0,6,0,5,0,0,0,0],[0,0,0,6,0,5,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,4,0,0,0]],[[0,0,0,0,0,0,0,0,0,0],[0,5,5,5,5,5,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,6,6,6,6,6,6,0,0],[0,3,0,0,0,0,0,0,0,0],[0,3,0,0,0,0,2,2,0,0],[0,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,4,0,0,0]],[[0,0,0,0,0,0,0,0,0,0],[0,5,5,5,5,5,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,2,0,0,0],[0,0,0,6,0,0,2,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,4,4,4,4,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,0,0],[0,5,5,5,5,5,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,4,4,4,4,0],[0,3,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[2,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],[[0,0,0,0,0,0,0,0,2,0],[0,5,5,5,5,5,0,0,2,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,4,0,0,0]]],this.levels.ships=[{ship2:{angle:0},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:90}},{ship2:{angle:90},ship3:{angle:90},ship4:{angle:0},ship5:{angle:90},ship6:{angle:90}},{ship2:{angle:0},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:0}},{ship2:{angle:90},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:90}},{ship2:{angle:0},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:90}},{ship2:{angle:90},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:90}}],this.game.data.loser="",console.log("Player Score: "+this.game.data.playerScore)},Battleship.GameState.preload=function(){this.load.image("bullet","img/assets/gfx/rocket.png"),this.load.image("player","img/assets/gfx/bullet.png"),this.load.image("enemy","img/assets/gfx/player.png"),this.load.image("ground","img/assets/gfx/ground.png"),this.load.image("ship2","img/assets/gfx/Ship2.png"),this.load.image("ship3","img/assets/gfx/Ship3.png"),this.load.image("ship4","img/assets/gfx/Ship4.png"),this.load.image("ship5","img/assets/gfx/Ship5.png"),this.load.image("ship6","img/assets/gfx/Ship6.png"),this.load.spritesheet("explosion","img/assets/gfx/explosion.png",128,128),this.load.spritesheet("cell","img/assets/gfx/cells.png",64,64),this.load.audio("music",["img/assets/audio/Battleship.mp3","img/assets/audio/Battleship.ogg"]),this.load.audio("explosion","img/assets/audio/Explosion Blast Large 05.mp3"),this.load.audio("sunkenShip","img/assets/audio/Explosion Blast Debris Large 01.mp3"),this.load.audio("shoot","img/assets/audio/Explosion Cannon Fire 01.mp3"),this.load.audio("miss","img/assets/audio/Liquid Water Water Splash Hands Big Splash 02.mp3")},Battleship.GameState.positionData=function(){var t={},e=this.matrix.length,a=this.game.rnd.integerInRange(0,e-1);return t.matrix=this.matrix[a],t.index=a,t},Battleship.GameState.create=function(){this.game.stage.backgroundColor="#4488cc",this.game.data.playerBoard||"enemy"!=this.game.data.turn?"enemy"==this.game.data.turn&&this.spawnBoard(this.game.data.playerBoard):(this.game.data.playerBoard=this.positionData(),this.spawnBoard(this.game.data.playerBoard)),this.game.data.enemyBoard||"player"!=this.game.data.turn?"player"==this.game.data.turn&&this.spawnBoard(this.game.data.enemyBoard):(this.game.data.enemyBoard=this.positionData(),this.spawnBoard(this.game.data.enemyBoard)),this.gun=this.game.add.sprite(this.game.width/2,this.game.height-10,"player"),this.gun.anchor.setTo(.5,.5),this.bulletPool=this.game.add.group();for(var t=0;t<this.reservedBullets;t++){var e=this.game.add.sprite(0,0,"bullet");this.bulletPool.add(e),e.anchor.setTo(.5,.5),this.game.physics.enable(e,Phaser.Physics.ARCADE),e.kill()}this.game.input.activePointer.x=this.game.width/2,this.game.input.activePointer.y=this.game.height/2,this.explosionGroup=this.game.add.group(),this.music=this.add.audio("music"),this.music.loopFull(.6)},Battleship.GameState.shipPlacement=function(t,e,a){switch(e){case 2:!0!==this.ship2.placed&&(90===this.levels.ships[a].ship2.angle?this.ship2.location=this.game.add.sprite(t.x+32,t.y-32,"ship2"):0===this.levels.ships[a].ship2.angle&&(this.ship2.location=this.game.add.sprite(t.x-32,t.y-32,"ship2")),this.ship2.location.angle=this.levels.ships[a].ship2.angle,this.ship2.location.visible=!1,this.ship2.placed=!0);break;case 3:!0!==this.ship3.placed&&(90===this.levels.ships[a].ship3.angle?this.ship3.location=this.game.add.sprite(t.x+32,t.y-32,"ship3"):0===this.levels.ships[a].ship3.angle&&(this.ship3.location=this.game.add.sprite(t.x-32,t.y-32,"ship3")),this.ship3.location.angle=this.levels.ships[a].ship3.angle,this.ship3.location.visible=!1,this.ship3.placed=!0);break;case 4:!0!==this.ship4.placed&&(90===this.levels.ships[a].ship4.angle?this.ship4.location=this.game.add.sprite(t.x+32,t.y-32,"ship4"):0===this.levels.ships[a].ship4.angle&&(this.ship4.location=this.game.add.sprite(t.x-32,t.y-32,"ship4")),this.ship4.location.angle=this.levels.ships[a].ship4.angle,this.ship4.location.visible=!1,this.ship4.placed=!0);break;case 5:!0!==this.ship5.placed&&(90===this.levels.ships[a].ship5.angle?this.ship5.location=this.game.add.sprite(t.x+32,t.y-32,"ship5"):0===this.levels.ships[a].ship5.angle&&(this.ship5.location=this.game.add.sprite(t.x-32,t.y-32,"ship5")),this.ship5.location.angle=this.levels.ships[a].ship5.angle,this.ship5.location.visible=!1,this.ship5.placed=!0);break;case 6:!0!==this.ship6.placed&&(90===this.levels.ships[a].ship6.angle?this.ship6.location=this.game.add.sprite(t.x+32,t.y-32,"ship6"):0===this.levels.ships[a].ship6.angle&&(this.ship6.location=this.game.add.sprite(t.x-32,t.y-32,"ship6")),this.ship6.location.angle=this.levels.ships[a].ship6.angle,this.ship6.location.visible=!1,this.ship6.placed=!0)}},Battleship.GameState.switchTurn=function(){console.log("Player Score: "+this.game.data.playerScore),"player"==this.game.data.turn?(this.music.stop(),this.game.data.turn="enemy",this.game.state.start("TurnState")):(this.music.stop(),this.game.data.turn="player",this.game.state.start("TurnState"))},Battleship.GameState.GameOverPlayer=function(){var t={},e=0;t=this.cells.children;for(var a=0;a<t.length;a++)e+=t[a].marker;e<=0&&"player"==this.game.data.turn?(this.gameOver=!0,this.game.data.loser="enemy"):this.gameOver=!1},Battleship.GameOverState=Battleship.GameOverState||{},Battleship.GameOverState.intro_text,Battleship.GameOverState.init=function(){},Battleship.GameOverState.preload=function(){},Battleship.GameOverState.create=function(){this.game.stage.backgroundColor="#222";var t=this.game.add.graphics();t.beginFill(0,.2),t.drawRect(0,300,800,100);var e={font:"bold 32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};"player"==this.game.data.loser?(this.intro_text=this.game.add.text(0,0,"You Lost! Tap to Restart",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)):"enemy"==this.game.data.loser&&(this.intro_text=this.game.add.text(0,0,"You Win! Tap to Restart",e),this.intro_text.setShadow(3,3,"rgba(0, 0, 0, 0.5)",2),this.intro_text.setTextBounds(-75,300,800,100)),t.inputEnabled=!0,t.events.onInputDown.add(this.gameStart,this)},Battleship.GameOverState.gameStart=function(){this.game.state.start("GameState")},Battleship.GameOverState.shutdown=function(){console.log("shutdown game over")},Battleship.GameState.enemyHit=function(t){t.hasEnemy=!1,t.frame=1,this.game.data.currentEnemyBoard.cellStatus=t.frame,this.shipHit=this.add.audio("explosion"),this.shipHit.play(),0===this.reservedBullets&&this.switchTurn()},Battleship.GameState.sunkEnemyBattleship=function(t){switch(t.enemyContact){case 2:this.cells.ship2+=t.enemyContact,4===this.cells.ship2&&(this.sunkShip=this.add.audio("sunkenShip"),this.sunkShip.play(),this.ship2.location.visible=!0);break;case 3:this.cells.ship3+=t.enemyContact,9===this.cells.ship3&&(this.sunkShip=this.add.audio("sunkenShip"),this.sunkShip.play(),this.ship3.location.visible=!0);break;case 4:this.cells.ship4+=t.enemyContact,16===this.cells.ship4&&(this.sunkShip=this.add.audio("sunkenShip"),this.sunkShip.play(),this.ship4.location.visible=!0);break;case 5:this.cells.ship5+=t.enemyContact,25===this.cells.ship5&&(this.sunkShip=this.add.audio("sunkenShip"),this.sunkShip.play(),this.ship5.location.visible=!0);break;case 6:this.cells.ship6+=t.enemyContact,36===this.cells.ship6&&(this.sunkShip=this.add.audio("sunkenShip"),this.sunkShip.play(),this.ship6.location.visible=!0)}!0===this.ship2.location.visible&&!0===this.ship3.location.visible&&!0===this.ship4.location.visible&&!0===this.ship5.location.visible&&!0===this.ship6.location.visible&&(this.game.data.loser="enemy",this.ship2.location.visible=!1,this.ship3.location.visible=!1,this.ship4.location.visible=!1,this.ship5.location.visible=!1,this.ship6.location.visible=!1)},Battleship.GameState.miss=function(t){t.frame=2,this.game.data.currentEnemyBoard.cellStatus=t.frame,this.missEnemy=this.add.audio("miss"),this.missEnemy.play(),0===this.reservedBullets&&this.switchTurn()},Battleship.GameState.simulateShooting=function(t){this.selectedCell,this.game.data.isShooting=!0,setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell))},1e3),setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell))},2e3),setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell))},3e3),setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell))},4e3),setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell))},5e3),setTimeout(function(){Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)],Battleship.GameState.selectedCell==t.children[Battleship.GameState.selectedCell]&&(Battleship.GameState.selectedCell=t.children[Battleship.GameState.game.rnd.integerInRange(0,99)]),"enemy"==Battleship.game.data.turn&&(Battleship.GameState.gun.rotation=Battleship.GameState.game.physics.arcade.angleBetween(Battleship.GameState.gun,Battleship.GameState.selectedCell),Battleship.GameState.attackCell(Battleship.GameState.selectedCell)),setTimeout(function(){Battleship.GameState.switchTurn()},500),Battleship.game.data.isShooting=!1},6e3)},Battleship.GameState.targetShot=function(){if(void 0===this.lastBulletShotAt&&(this.lastBulletShotAt=0),!(this.game.time.now-this.lastBulletShotAt<this.SHOT_DELAY+this.game.rnd.integerInRange(250,500))){this.lastBulletShotAt=this.game.time.now;var t=this.bulletPool.getFirstDead();null!==t&&void 0!==t&&(t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.gun.x,this.gun.y),t.rotation=this.gun.rotation,t.body.velocity.x=Math.cos(t.rotation)*this.BULLET_SPEED,t.body.velocity.y=Math.sin(t.rotation)*this.BULLET_SPEED,this.cannonShot=this.add.audio("shoot"),this.cannonShot.play())}},Battleship.GameState.attackCell=function(t){0===t.frame&&(this.targetShot(),this.game.physics.enable(t,Phaser.Physics.ARCADE),t.body.immovable=!0,t.body.allowGravity=!1,t.hasEnemy&&(t.enemyContact=t.marker,t.marker=0))},Battleship.GameState.checkEnemyCollision=function(){this.game.physics.arcade.collide(this.bulletPool,this.playerCells,function(t,e){t.kill(),e.hasEnemy?(this.getExplosion(e,e.posX,e.posY),this.enemyHit(e),this.sunkEnemyBattleship(e),this.game.data.playerScore+=e.enemyContact):this.miss(e),this.gameOver&&(this.cells.forEach(function(t){t.frame=0},this),this.music.stop(),this.gun.destroy(),this.ship2.location.destroy(),this.ship3.location.destroy(),this.ship4.location.destroy(),this.ship5.location.destroy(),this.ship6.location.destroy(),this.game.data.loser="player",this.game.state.start("GameOverState")),e.body.enable&&(e.body.enable=!1)},null,this)},Battleship.GameState.GameOverEnemy=function(){var t={},e=0;t=this.playerCells.children;for(var a=0;a<t.length;a++)e+=t[a].marker;e<=0&&"enemy"==this.game.data.turn?this.gameOver=!0:this.gameOver=!1},Battleship.GameState.spawnBoard=function(t){if(this.BOARD_COLS=Math.floor(this.game.world.width/this.CELL_SIZE_SPACED),this.BOARD_ROWS=Math.floor(this.game.world.height/this.CELL_SIZE_SPACED-1),this.cells=this.game.add.group(),this.playerCells=this.game.add.group(),this.cells.ship2=0,this.cells.ship3=0,this.cells.ship4=0,this.cells.ship5=0,this.cells.ship6=0,this.ship2.placed=!1,this.ship3.placed=!1,this.ship4.placed=!1,this.ship5.placed=!1,this.ship6.placed=!1,"player"==this.game.data.turn){for(var e=0;e<this.BOARD_COLS;e++)for(var a=0;a<this.BOARD_ROWS;a++){var s=this.cells.create(e*this.CELL_SIZE_SPACED+this.CELL_SIZE_SPACED/2+2,a*this.CELL_SIZE_SPACED+this.CELL_SIZE/2+2,"cell",0);s.anchor.setTo(.5,.5),s.name="cell: "+e.toString()+"x"+a.toString(),s.inputEnabled=!0,s.enemyContact=0,s.marker=t.matrix[a][e],this.shipPlacement(s,s.marker,t.index),s.posX=s.x,s.posY=s.y,s.hasEnemy=s.marker>0,s.events.onInputDown.add(this.selectCell,this)}this.game.data.currentEnemyBoard=this.cells}else if("enemy"==this.game.data.turn){for(var i=0;i<this.BOARD_COLS;i++)for(var h=0;h<this.BOARD_ROWS;h++){var l=this.playerCells.create(i*this.CELL_SIZE_SPACED+this.CELL_SIZE_SPACED/2+2,h*this.CELL_SIZE_SPACED+this.CELL_SIZE/2+2,"cell",0);l.anchor.setTo(.5,.5),l.name="cell: "+i.toString()+"x"+h.toString(),l.enemyContact=0,l.marker=t.matrix[h][i],this.shipPlacement(l,l.marker,t.index),l.posX=l.x,l.posY=l.y,l.hasEnemy=l.marker>0}this.game.data.currentPlayerBoard=this.playerCells}},Battleship.GameState.shootBullet=function(){if(void 0===this.lastBulletShotAt&&(this.lastBulletShotAt=0),!(this.game.time.now-this.lastBulletShotAt<this.SHOT_DELAY)){this.lastBulletShotAt=this.game.time.now;var t=this.bulletPool.getFirstDead();null!==t&&void 0!==t&&(t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.gun.x,this.gun.y),t.rotation=this.gun.rotation,t.body.velocity.x=Math.cos(t.rotation)*this.BULLET_SPEED,t.body.velocity.y=Math.sin(t.rotation)*this.BULLET_SPEED,this.cannonShot=this.add.audio("shoot"),this.cannonShot.play(),this.reservedBullets-=1)}},Battleship.GameState.update=function(){this.GameOverPlayer(),this.GameOverEnemy(),"player"==this.game.data.turn?this.gun.rotation=this.game.physics.arcade.angleToPointer(this.gun):"enemy"==this.game.data.turn&&(this.game.data.isShooting||this.simulateShooting(this.playerCells)),"player"==this.game.data.turn?this.checkPlayerCollision():"enemy"==this.game.data.turn&&this.checkEnemyCollision()},Battleship.GameState.getExplosion=function(t,e,a){var s=this.explosionGroup.getFirstDead();if(null===s){s=this.game.add.sprite(0,0,"explosion"),s.anchor.setTo(.5,.5);s.animations.add("boom",[0,0,1,2,3],60,!1).killOnComplete=!0,this.explosionGroup.add(s)}return s.revive(),s.x=e,s.y=a,s.angle=this.game.rnd.integerInRange(0,360),s.animations.play("boom"),s},Battleship.GameState.selectCell=function(t){t.input.pointerOver&&0===t.frame&&"player"==this.game.data.turn&&(this.shootBullet(),this.game.physics.enable(t,Phaser.Physics.ARCADE),t.body.immovable=!0,t.body.allowGravity=!1,t.hasEnemy&&(t.enemyContact=t.marker,t.marker=0))},Battleship.GameState.checkPlayerCollision=function(){this.game.physics.arcade.collide(this.bulletPool,this.cells,function(t,e){t.kill(),e.hasEnemy?(this.getExplosion(e,e.posX,e.posY),this.enemyHit(e),this.sunkEnemyBattleship(e),this.game.data.playerScore+=e.enemyContact):this.miss(e),this.gameOver&&(this.cells.forEach(function(t){t.frame=0},this),this.music.stop(),this.gun.destroy(),this.ship2.location.destroy(),this.ship3.location.destroy(),this.ship4.location.destroy(),this.ship5.location.destroy(),this.ship6.location.destroy(),this.game.data.playerScore+=Math.floor(32*Math.random())+4,console.log("Player Score: "+this.game.data.playerScore),this.game.state.start("GameOverState")),e.body.enable&&(e.body.enable=!1)},null,this)},Battleship.game=new Phaser.Game(664,730,Phaser.AUTO,"game-canvas"),Battleship.game.data={},Battleship.game.data.loser="",Battleship.game.data.turn="player",Battleship.game.data.playerScore=0,Battleship.game.data.currentEnemyBoard={},Battleship.game.data.currentEnemyBoard.cellStatus=0,Battleship.game.data.isShooting=!1,Battleship.game.state.add("HomeState",Battleship.HomeState),Battleship.game.state.add("TurnState",Battleship.TurnState),Battleship.game.state.add("GameState",Battleship.GameState),Battleship.game.state.add("GameOverState",Battleship.GameOverState),Battleship.game.state.start("HomeState");